CC = g++
MAKE = make
RM = rm -f
RMRF = rm -rf
FLAGS = -std=c++11

ROUTE = ../common/

DataLinkCacheDir = toDatalinkCache
NetworkCacheDir = toNetworkCache

COMMON-NAME = common
COMMON-SRC = $(ROUTE)$(COMMON-NAME).cpp
COMMON-H = $(ROUTE)$(COMMON-NAME).h

NETWORK-NAME = network
NETWORK-SRC = $(ROUTE)$(NETWORK-NAME).cpp
NETWORK-H = $(ROUTE)$(NETWORK-NAME).h

DATALINK-NAME = datalink
DATALINK-SRC = $(ROUTE)$(DATALINK-NAME).cpp
DATALINK-H = $(ROUTE)$(DATALINK-NAME).h

PHYSICAL-NAME = physical
PHYSICAL-SRC = $(ROUTE)$(PHYSICAL-NAME).cpp
PHYSICAL-H = $(ROUTE)$(PHYSICAL-NAME).h

NETWORK-NAME = network
NETWORK-SND-SRC = sender2_$(NETWORK-NAME).cpp
NETWORK-REC-SRC = receiver2_$(NETWORK-NAME).cpp
NETWORK-SND-TARGET = sender2_$(NETWORK-NAME)
NETWORK-REC-TARGET = receiver2_$(NETWORK-NAME)

DATALINK-NAME = datalink
DATALINK-SND-SRC = sender2_$(DATALINK-NAME).cpp
DATALINK-REC-SRC = receiver2_$(DATALINK-NAME).cpp
DATALINK-SND-TARGET = sender2_$(DATALINK-NAME)
DATALINK-REC-TARGET = receiver2_$(DATALINK-NAME)

PHYSICAL-NAME = physical
PHYSICAL-SND-SRC = sender2_$(PHYSICAL-NAME).cpp
PHYSICAL-REC-SRC = receiver2_$(PHYSICAL-NAME).cpp
PHYSICAL-SND-TARGET = sender2_$(PHYSICAL-NAME)
PHYSICAL-REC-TARGET = receiver2_$(PHYSICAL-NAME)

.PHONY: all clean receiver sender
	#avoid to make clean.*


all: $(NETWORK-SND-TARGET) $(NETWORK-REC-TARGET) \
	 $(DATALINK-SND-TARGET) $(DATALINK-REC-TARGET) \
	 $(PHYSICAL-SND-TARGET) $(PHYSICAL-REC-TARGET)

# $@-target
# $^-all prerequisites
# $<-first prerequisite


$(NETWORK-SND-TARGET): $(NETWORK-SND-SRC)
	$(CC) $(FLAGS) -o $@ $(NETWORK-SND-SRC) $(NETWORK-SRC) $(NETWORK-H) $(COMMON-SRC) $(COMMON-H)
$(NETWORK-REC-TARGET): $(NETWORK-REC-SRC)
	$(CC) $(FLAGS) -o $@ $(NETWORK-REC-SRC) $(NETWORK-SRC) $(NETWORK-H) $(COMMON-SRC) $(COMMON-H)

$(DATALINK-SND-TARGET): $(DATALINK-SND-SRC)
	$(CC) $(FLAGS) -o $@ $(DATALINK-SND-SRC) $(DATALINK-SRC) $(DATALINK-H) $(COMMON-SRC) $(COMMON-H)
$(DATALINK-REC-TARGET): $(DATALINK-REC-SRC)
	$(CC) $(FLAGS) -o $@ $(DATALINK-REC-SRC) $(DATALINK-SRC) $(DATALINK-H) $(COMMON-SRC) $(COMMON-H)

$(PHYSICAL-SND-TARGET): $(PHYSICAL-SND-SRC)
	$(CC) $(FLAGS) -o $@ $(PHYSICAL-SND-SRC) $(PHYSICAL-SRC) $(PHYSICAL-H) $(COMMON-SRC) $(COMMON-H)
$(PHYSICAL-REC-TARGET): $(PHYSICAL-REC-SRC)
	$(CC) $(FLAGS) -o $@ $(PHYSICAL-REC-SRC) $(PHYSICAL-SRC) $(PHYSICAL-H) $(COMMON-SRC) $(COMMON-H)

clean:
	$(RM) $(NETWORK-SND-TARGET) $(NETWORK-REC-TARGET) \
	 	  $(DATALINK-SND-TARGET) $(DATALINK-REC-TARGET) \
	 	  $(PHYSICAL-SND-TARGET) $(PHYSICAL-REC-TARGET) \
		  *.o
	$(RMRF) $(NetworkCacheDir) $(NetworkCacheDir)


receiver:
	./receiver2_datalink &
	./receiver2_network ywwuyi_rec.mp4 &
	./receiver2_physical 4000 &

sender:
	./sender2_datalink &
	./sender2_network ywwuyi.mp4 &
	./sender2_physical 192.168.137.64 4000 &
